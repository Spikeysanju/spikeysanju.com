import{p as f}from"./parse.d12b0d5b.js";import{j as h}from"./singletons.df52d8b6.js";import{i as A}from"./navigation.bc119b24.js";const w=h.apply_action;function E(e){const r=JSON.parse(e);return r.data&&(r.data=f(r.data)),r}function k(e,r=()=>{}){const c=async({action:n,result:a,reset:o})=>{a.type==="success"&&(o!==!1&&HTMLFormElement.prototype.reset.call(e),await A()),(location.origin+location.pathname===n.origin+n.pathname||a.type==="redirect"||a.type==="error")&&w(a)};async function s(n){var u,d,b;n.preventDefault();const a=new URL((u=n.submitter)!=null&&u.hasAttribute("formaction")?n.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(e).action),o=new FormData(e),l=(d=n.submitter)==null?void 0:d.getAttribute("name");l&&o.append(l,((b=n.submitter)==null?void 0:b.getAttribute("value"))??"");const p=new AbortController;let m=!1;const y=await r({action:a,cancel:()=>m=!0,controller:p,data:o,form:e})??c;if(m)return;let i;try{const t=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:o,signal:p.signal});i=E(await t.text()),i.type==="error"&&(i.status=t.status)}catch(t){if((t==null?void 0:t.name)==="AbortError")return;i={type:"error",error:t}}y({action:a,data:o,form:e,update:t=>c({action:a,result:i,reset:t==null?void 0:t.reset}),result:i})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",s)}}}export{k as e};
